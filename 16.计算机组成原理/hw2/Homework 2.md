# Homework 2

2018011365 张鹤潇

#### 1.

错误，引入虚存的目的主要是增大内存容量，便于操作系统管理内存。

#### 2.

错误，引入 cache 的目的是提高内存读取效率，利用局部性缓解内存读取造成的性能瓶颈，并无提高主存容量的效果。

#### 3.

错误。RAID4 与 RAID5 的检错纠错原理一致，能力相同：都只能在一块磁盘数据损坏时恢复，如果有两块磁盘相同位损坏，数据就丢失了。

#### 4.

D

#### 5.

B

#### 6.

D

直接相连比全相连 cache 命中率更高的一个例子：缓存行大小 1 byte，容量为 4 byte，全相连替换方式为 LRU，依次访问内存地址 0, 1, 2, 3, 7, 11, 15 , 0, 1, 2. 直接相连最后三次访存会命中，全相连会全部丢失。

#### 7.

C

#### 8.

C

#### 9.

C

#### 10.

C

#### 11.

B

### 12.

容量缺失，冲突缺失。

### 13.

2 TB，1.25 TB

### 14.

91% 29 ns

### 15.

(1).

虚拟地址组成 `TLBT(6) TLBI(2) VPO(6) = VPN(8) VPO(6)`

物理地址组成 `CT(6) CI(4) CO(2) = PPN(6) PPO(6)`，同时有 `VPO(6) = PPO(6) = CI(4) CO(2)` .

- TLBI 2 位
- TLBT 6 位
- VPN 8 位
- PPN 6 位
- VPO 6 位
- PPO 6 位
- CT 6 位
- CI 4 位
- CO 2 位

(2).

| 虚地址       | 0x027c | 0x03a9 | 0x0040 | 0x03d7 |
| ------------ | ------ | ------ | ------ | ------ |
| TLB 命中     | F      | F      | F      | T      |
| 缺页         | F      | F      | T      | F      |
| 物理页号     | 0x17   | 0x11   | -      | 0x0D   |
| 缓存命中     | F      | F      | -      | T      |
| 字节偏移     | 0      | 1      | 0      | 3      |
| 返回缓存字节 | -      | -      | -      | 0x1D   |

### 16.

这种设计是为了更好地发挥空间局部性。

简单起见，以 4 位物理地址 (`tag(2) index(2) offset(0)`) 为例。如果以中段地址为索引，则相邻地址会被映射到不同缓存行；而如果以高端地址为索引，则相邻地址会被映射到相同缓存行上。

| addr | cache line(middle) | cache line(high) |
| ---- | ------------------ | ---------------- |
| 0000 | 0                  | 0                |
| 0001 | 1                  | 0                |
| 0010 | 2                  | 0                |
| 0011 | 3                  | 0                |
| 0100 | 0                  | 1                |
| 0101 | 1                  | 1                |
| 0110 | 2                  | 1                |
| 0111 | 3                  | 1                |

根据空间局部性原理，相邻的地址会更多地被读写。故以中段地址为索引能降低冲突损失，提高缓存命中率。

### 17.

(1).

- 页内地址11位，虚页号 32-11=21 位
- 实页号 28-11=17 位
- cache 标记字段 12 位
- cache 块号字段 10 位
- cache 块内字段 6 位

(2).

`a[i+j*32]++` 的执行需要 load 和 store 两次访存。

在本题设定下，实地址分为 `tag(22) index(2) offset(4)  `

A，B 运行结束后的 Cache 状态相同，均为

|      | T    | V    | W0   | W1   | W2   | W3   | T    | V    | W0    | W1    | W2    | W3    |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ----- | ----- | ----- | ----- |
| 0    |      |      |      |      |      |      |      |      |       |       |       |       |
| 1    |      |      |      |      |      |      |      |      |       |       |       |       |
| 2    | 0x10 | 1    | a[0] | a[1] | a[2] | a[3] | 0x12 | 1    | a[32] | a[33] | a[34] | a[35] |
| 3    |      |      |      |      |      |      |      |      |       |       |       |       |

只有在 a[0] 和 a[32]  Load 时 miss，命中率 $1-\frac{2}{8*2}=87.5\%$.

